{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}{{ post['title'] }}{% endblock %}</h1>
  <div class="about">Posted by
    {% if g.user['id'] != post['author_id'] %}
      <a href="{{ url_for('user.profile_others', username=post['username']) }}">{{ post['username'] }}</a>
    {% else %}
      <a href="{{ url_for('user.profile', username=post['username']) }}">{{ post['username'] }}</a>
    {% endif %}
    on {{ post['created'].strftime('%Y-%m-%d %I:%M %p') }}
  </div>
{% endblock %}

{% block content %}
    {% if post['body'] %}
        <div>
            <p>{{ post['body'] }}</p>
        </div>
    {% else %}
        <br>
    {% endif %}
        <div class = "stats">
            {{ post['like_count'] }} Likes &nbsp;&nbsp;&nbsp;
            {{ post['comment_count'] }} Comments</a> &nbsp;&nbsp;&nbsp;
            {% if g.user['id'] == post['author_id'] %}
              <a class="action" href="{{ url_for('blog.update', id=post['id']) }}">Edit</a>
            {% endif %} 
            <br>
            {% if has_liked_post(g.user['id'], post['id']) %}
            <form action="{{ url_for('blog.like_post', id=post['id']) }}" method='POST'>
              <div class= "like_button"><button type="submit">Unlike</button></div>
            </form>
        {% else %}
            <form action="{{ url_for('blog.like_post', id=post['id']) }}" method='POST'>
              <div class= "like_button"><button type="submit">Like</button></div>
            </form>
        {% endif %}
        </div>
    <div>
        <p>{{ 'Comments:' }}</p>
        {% for comment in comments %}
        <article class="post">
            <header>
              <div>
                <h1>{{ comment['author_username'] }}</h1>
                <div class="about">by
                  {% if g.user['id'] != comment['author_id'] %}
                    <a href="{{ url_for('user.profile_others', username=comment['author_username']) }}">{{ comment['author_username'] }}</a>
                  {% else %}
                    <a href="{{ url_for('user.profile', username=comment['author_username']) }}">{{ comment['author_username'] }}</a>
                  {% endif %}
                  on {{ post['created'].strftime('%Y-%m-%d %I:%M %p') }}
                </div>
              </div>
              <!-- {% if g.user['id'] == comment['author_id'] %}
                <a class="action" href="{{ url_for('blog.update', id=comment['id']) }}">Edit</a>
              {% endif %} -->
            </header>
            <p class="body">{{ comment['body'] }}</p>
            <div class = "stats">
              <!-- {{ post['like_count'] }} Likes &nbsp;&nbsp;&nbsp;
              {{ post['comment_count'] }} Comments</a> &nbsp;&nbsp;&nbsp; 
              <br>
              {% if has_liked_post(g.user['id'], post['id']) %}
                  <form action="{{ url_for('blog.like_post', id=post['id']) }}" method='POST'>
                    <div class= "like_button"><button type="submit">Unlike</button></div>
                  </form>
              {% else %}
                  <form action="{{ url_for('blog.like_post', id=post['id']) }}" method='POST'>
                    <div class= "like_button"><button type="submit">Like</button></div>
                  </form>
              {% endif %} -->
              {% if g.user['id'] == comment['author_id'] %}
                <a class="action" href="{{ url_for('blog.update_comment', post_id=post['id'], id=comment['id']) }}">Edit</a>
                &nbsp;
              {% endif %}
              Reply
              <!-- <a href="{{ url_for('blog.view_post', id=post['id']) }}"> Reply </a> -->
            </div>
        </article>
        {% endfor %}
        <form method="post">
            <label for="comment">Add Comment</label>
            <input name="comment" id="comment" required>
            <br>
            <input type="submit" value="Comment">
        </form>
    </div>
{% endblock %}